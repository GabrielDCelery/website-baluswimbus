var adminModule=angular.module("adminModule",["ngRoute","authController","authFactory","postListController","addNewPostController","detailedPostController","postsFactory","textEditorFactory"]);adminModule.config(["$routeProvider",function(t){t.when("/",{templateUrl:"admin/templates/_main.html",controller:"postListCtrl"}).when("/addnew",{templateUrl:"admin/templates/_addnew.html",controller:"addNewPostCtrl"}).when("/:id",{templateUrl:"admin/templates/_post.html",controller:"detailedPostCtrl"}).otherwise({redirectTo:"/"})}]);var authFactory=angular.module("authFactory",[]);authFactory.factory("passwordEncryption",function(){function t(t){var e="";if("undefined"!=typeof t){var a,n,r,s,l,i="",d="",p=0;do a=t.charCodeAt(p++),n=t.charCodeAt(p++),i=t.charCodeAt(p++),r=a>>2,s=(3&a)<<4|n>>4,l=(15&n)<<2|i>>6,d=63&i,isNaN(n)?l=d=64:isNaN(i)&&(d=64),e=e+o.charAt(r)+o.charAt(s)+o.charAt(l)+o.charAt(d),a=n=i="",r=s=l=d="";while(p<t.length)}return e}function e(t){var e="";if("undefined"!=typeof t){var a,n,r,s,l,i="",d="",p=0,c=/[^A-Za-z0-9\+\/\=]/g;c.exec(t)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do r=o.indexOf(t.charAt(p++)),s=o.indexOf(t.charAt(p++)),l=o.indexOf(t.charAt(p++)),d=o.indexOf(t.charAt(p++)),a=r<<2|s>>4,n=(15&s)<<4|l>>2,i=(3&l)<<6|d,e+=String.fromCharCode(a),64!=l&&(e+=String.fromCharCode(n)),64!=d&&(e+=String.fromCharCode(i)),a=n=i="",r=s=l=d="";while(p<t.length)}return e}var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:t,decode:e}}),authFactory.factory("passwordValidation",["$http",function(t){function e(e,o,a){t({method:"POST",data:{username:e,password:o},url:"admin/php/password-validation.php"}).then(a)}return{check:e}}]);var authController=angular.module("authController",["ngCookies"]);authController.controller("authCtrl",["$scope","$cookies","passwordEncryption","passwordValidation",function(t,e,o,a){function n(e){"true"==e.data?(t.display.login=!1,t.display.content=!0):(t.display.login=!0,t.display.content=!1)}function r(r,s){var l=o.encode(s);a.check(r,l,n),e.put("loginUser",t.username),e.put("loginPassword",t.password)}function s(){t.display.login=!0,t.display.content=!1,e.remove("loginUser"),e.remove("loginPassword")}t.display={login:!1,content:!1},t.username=e.get("loginUser"),t.password=e.get("loginPassword"),r(t.username,t.password),t.login=r,t.logout=s}]);var postsFactory=angular.module("postsFactory",[]);postsFactory.factory("connectToPostsDatabase",["$http",function(t){function e(e){t({method:"GET",url:"admin/php/get-list-of-posts.php"}).then(e)}function o(e,o){t({method:"POST",url:"admin/php/get-posts.php",data:{data:e}}).then(o)}function a(e,o){t({method:"POST",url:"admin/php/addnew-post.php",data:{data:e}}).then(o)}function n(e,o){t({method:"PUT",url:"admin/php/update-post.php",data:{data:e}}).then(o)}function r(e,o){t({method:"DELETE",url:"admin/php/delete-post.php",data:{data:e}}).then(o)}return{getList:e,getPosts:o,addNewPost:a,updatePost:n,deletePost:r}}]);var textEditorFactory=angular.module("textEditorFactory",[]);textEditorFactory.factory("textEditor",["$http",function(t){function e(t){this.string=t}return e.prototype.replaceAll=function(t,e){return this.string=this.string.replace(new RegExp(t,"g"),e),this},e.prototype.trimText=function(){return this.string=this.string.trim(),this},{HtmlString:e}}]);var addNewPostController=angular.module("addNewPostController",[]);addNewPostController.controller("addNewPostCtrl",["$scope","$location","connectToPostsDatabase","textEditor",function(t,e,o,a){function n(t){var e=new a.HtmlString(t);return e.trimText().replaceAll('"',"&quot;").replaceAll("<div><br></div>","<p></p>").replaceAll("<div","<p").replaceAll("/div>","/p>"),e}var r=document.getElementById("textEditorContent");t.post={post_title:"",post_date:new Date,post_content:"",post_status:"draft"},t.saveIntoDatabase=function(a){t.post.post_status=a;var s=r.innerHTML;s=n(s).string,t.post.post_content=s;var l=t.post;o.addNewPost(l,function(t){alert(t.data),e.path("/")})}}]);var detailedPostController=angular.module("detailedPostController",["ngRoute"]);detailedPostController.controller("detailedPostCtrl",["$scope","$routeParams","connectToPostsDatabase","textEditor",function(t,e,o,a){function n(t){var e=new a.HtmlString(t);return e.replaceAll("&quot;",'"').replaceAll("<p></p>","<div><br></div>").replaceAll("<p>","<div>").replaceAll("</p>","</div>"),e}function r(t){var e=new a.HtmlString(t);return e.trimText().replaceAll('"',"&quot;").replaceAll("<div><br></div>","<p></p>").replaceAll("<div","<p").replaceAll("/div>","/p>"),e}function s(e){o.getPosts(e,function(e){t.post.id=e.data[0].id,t.post.post_title=e.data[0].post_title,t.post.post_date=new Date(e.data[0].post_date),t.post.post_status=e.data[0].post_status;var o=e.data[0].post_content;o=n(o).string,t.post.post_content=o,i.innerHTML=o})}var l=[e.id],i=document.getElementById("textEditorContent");t.post={id:0,post_title:"",post_date:new Date,post_content:"",post_status:"active"},t.saveIntoDatabase=function(e){t.post.post_status=e;var a=i.innerHTML;a=r(a).string,t.post.post_content=a;var n=t.post;o.updatePost(n,function(t){alert(t.data),s(l)})},s(l)}]);var postListController=angular.module("postListController",[]);postListController.controller("postListCtrl",["$scope","connectToPostsDatabase",function(t,e){function o(t,e){for(var o=t.length,a=Math.ceil(o/e),n=[],r=1;a>=r;r++)n.push(r);return n}function a(t,e,o){for(var a=[],n=(e-1)*o,r=(e-1)*o+o,s=n;r>s;s++)"undefined"!=typeof t[s]&&a.push(t[s].id);return a}function n(o){t.selectedPage=o;var n=a(t.listOfIds,t.selectedPage,t.numberOfPostsPerPage);e.getPosts(n,function(e){t.listOfPosts=e.data})}function r(){e.getList(function(e){t.listOfIds=e.data,t.listOfPages=o(t.listOfIds,t.numberOfPostsPerPage),n(1)})}t.listOfIds=[],t.numberOfPostsPerPage=3,t.listOfPages=[],t.listOfPosts=[],t.selectedPage,t.switchPage=function(t){n(t)},t.deletePost=function(t){var o=confirm("Biztosan törölni akarja a bejegyzést?");o&&e.deletePost(t,function(t){alert(t.data),r()})},r()}]);