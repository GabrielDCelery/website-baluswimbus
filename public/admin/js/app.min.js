var AdminApp=angular.module("AdminApp",["ngRoute","ngCookies","AuthCtrl","AuthFactory","AddNewCtrl","PostsCtrl","EditCtrl","ui.tinymce","DatabaseFactory","TextEditorFactory","AlertsFactory"]);AdminApp.config(["$routeProvider","$locationProvider",function(t,e){t.when("/addnew",{templateUrl:"templates/_addnew.html",controller:"AddNewCtrl"}).when("/",{templateUrl:"templates/_posts.html",controller:"PostsCtrl"}).when("/:id",{templateUrl:"templates/_edit.html",controller:"EditCtrl"}).otherwise({redirectTo:"/"})}]);var AuthCtrl=angular.module("AuthCtrl",[]);AuthCtrl.controller("AuthCtrl",["$scope","AuthFactory",function(t,e){function o(o,a){e.login(o,a,function(r){r.data?(t.loggedIn=!0,e.setLoginCookie(o,a)):t.loggedIn=!1})}function a(){t.loggedIn=!1,e.clearLoginCookie()}function r(t){e.getLoginCookie(t)}t.loggedIn=!1,t.login=o,t.logout=a,r(o)}]);var AuthFactory=angular.module("AuthFactory",[]);AuthFactory.factory("AuthFactory",["$http","$cookies",function(t,e){function o(e,o,a){t.post("php/login.php",{username:e,password:o}).success(a)}function a(t,o){var a=s.encode(t),r=s.encode(o),n={username:a,password:r};e.putObject("userCookie",n)}function r(){e.remove("userCookie")}function n(t){var o=e.getObject("userCookie");if(o){var a=s.decode(o.username),r=s.decode(o.password);t(a,r)}}var s={keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){var e,o,a,r,n,s="",i="",c="",l=0;do e=t.charCodeAt(l++),o=t.charCodeAt(l++),i=t.charCodeAt(l++),a=e>>2,r=(3&e)<<4|o>>4,n=(15&o)<<2|i>>6,c=63&i,isNaN(o)?n=c=64:isNaN(i)&&(c=64),s=s+this.keyStr.charAt(a)+this.keyStr.charAt(r)+this.keyStr.charAt(n)+this.keyStr.charAt(c),e=o=i="",a=r=n=c="";while(l<t.length);return s},decode:function(t){var e,o,a,r,n,s="",i="",c="",l=0,d=/[^A-Za-z0-9\+\/\=]/g;d.exec(t)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do a=this.keyStr.indexOf(t.charAt(l++)),r=this.keyStr.indexOf(t.charAt(l++)),n=this.keyStr.indexOf(t.charAt(l++)),c=this.keyStr.indexOf(t.charAt(l++)),e=a<<2|r>>4,o=(15&r)<<4|n>>2,i=(3&n)<<6|c,s+=String.fromCharCode(e),64!=n&&(s+=String.fromCharCode(o)),64!=c&&(s+=String.fromCharCode(i)),e=o=i="",a=r=n=c="";while(l<t.length);return s}};return{login:o,setLoginCookie:a,clearLoginCookie:r,getLoginCookie:n}}]);var AddNewCtrl=angular.module("AddNewCtrl",[]);AddNewCtrl.controller("AddNewCtrl",["$scope","TextEditor","Database","Alerts",function(t,e,o,a){function r(r){t.postData.input=e.checkInput(t.tinymceModel),t.postData.status=r,o.addNewPost(t.postData,function(t){a.checkSuccess(t.data)})}t.postData={title:"",date:new Date,input:"",status:""},t.addNewPost=r}]);var PostsCtrl=angular.module("PostsCtrl",[]);PostsCtrl.controller("PostsCtrl",["$scope","Alerts","Database",function(t,e,o){function a(){o.getListOfPosts(function(e){t.listOfPosts=e.data})}function r(t){e.confirmChange(function(){o.deletePost(t,function(t){e.checkSuccess(t.data),a()})})}t.listOfPosts,t.sortField="date",t.reverseOrder=!0,t.deletePost=r,a()}]);var EditCtrl=angular.module("EditCtrl",["ui.tinymce"]);EditCtrl.controller("EditCtrl",["$scope","$location","$routeParams","TextEditor","Alerts","Database",function(t,e,o,a,r,n){function s(e){n.getPost(e,function(e){var o=e.data[0];t.postData.title=o.post_title,t.postData.date=new Date(o.post_date),t.postData.input=o.post_content,t.postData.status=o.post_status})}function i(){n.editPost(t.postData,function(t){r.checkSuccess(t.data),e.path("/posts")})}t.postData={id:o.id,title:"",date:new Date,input:"",status:""},t.editPost=i,s(t.postData.id)}]);var DatabaseFactory=angular.module("DatabaseFactory",[]);DatabaseFactory.factory("Database",["$http",function(t){function e(e){t.get("php/get_list_of_posts.php").then(e)}function o(e,o){t.post("php/get_post.php",e).then(o)}function a(e,o){t.post("php/save_post.php",e).then(o)}function r(e,o){t.post("php/delete_post.php",e).then(o)}function n(e,o){t.post("php/edit_post.php",e).then(o)}return{getListOfPosts:e,getPost:o,addNewPost:a,deletePost:r,editPost:n}}]);var TextEditorFactory=angular.module("TextEditorFactory",[]);TextEditorFactory.factory("TextEditor",["$http",function(t){function e(t){return t||(t=tinyMCE.activeEditor.getContent()),t}return{checkInput:e}}]);var AlertsFactory=angular.module("AlertsFactory",[]);AlertsFactory.factory("Alerts",["$http",function(t){function e(t){var e=confirm("Biztosan végre szeretné hajtani a változtatásokat?");e&&t()}function o(t){1==t?alert("Feladat sikeresen végrehajtva!"):alert("Nem sikerült a feladatot végehajtani!")}return{checkSuccess:o,confirmChange:e}}]);